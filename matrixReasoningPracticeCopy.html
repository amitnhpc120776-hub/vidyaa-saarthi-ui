<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vidyaa Saarthi - Matrix Reasoning</title>

    <!-- BOOOTSTRAP 5.3.8 CSS (CDN)-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <!--VIS DESIGN SYSTEM FILES -->
    <link rel="stylesheet" href="../../../css/VS-Design-System.css" />
    <link rel="stylesheet" href="../../../css/custom-component.css" />
    <!-- PAGE-SPECIFIC CSS (Optional) -->
    <style>
      .mr-test-shell {
        max-width: 560px;
        margin-inline: auto;
      }
      /* Shared Frame Component reusable visual container for Question frame and Answer frame*/
      .mr-frame {
        width: min(90vw, 100%);
        margin-inline: auto;
        background: var(--bs-body-bg);
        border: 1px solid var(--bs-border-color);
        border-radius: var(--bs-border-radius-lg);
        padding: clamp(6px, 1.5vw, 10px);
      }
      /* Question Frame (Square Matrix Area) - Forces the matrix container to remain square.*/
      .mr-question-frame {
        display: grid;
        place-items: center; /* centers matrix inside frame */
      }
      /* Matrix Grid Container - Creates the 3×3 matrix layout.*/
      .mr-matrix {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(4px, 1.2vw, 6px);

        width: clamp(260px, 80vw, 300px);
        aspect-ratio: 1;
      }
      /*Individual Matrix Cells - Defines each of the 9 matrix cells*/
      .mr-cell {
        aspect-ratio: 1;
        display: grid;
        place-items: center; /* horizontal + vertical centering */
        border: 1px solid var(--bs-border-color);
        border-radius: var(--bs-border-radius);
        background: var(--bs-tertiary-bg);
        user-select: none;
        padding: 4px; /* MAX 4px gap from cell border */
        box-sizing: border-box;
      }
      /* Cell Image */
      .mr-cell__img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* preserves aspect ratio */
        display: block;
      }
      /*Visually distinguishes the cell to be completed*/
      .mr-cell--missing {
        background: var(--bs-body-bg);
        border-style: dashed;
        font-size: clamp(20px, 6vw, 32px);
      }
      /* Answer Options Grid - Renders answer options in a 2×3 grid*/
      .mr-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(8px, 2vw, 12px);

        width: clamp(260px, 80vw, 300px);
      }
      /* Answer Option Buttons - Represents a single selectable answer.*/
      .mr-option {
        aspect-ratio: 1;
        min-width: 44px;
        min-height: 44px;
        display: grid;
        place-items: center;
        border: 2px solid var(--bs-border-color);
        border-radius: var(--bs-border-radius);
        background: var(--bs-body-bg);
        font-weight: 600;
      }

      .mr-option:hover {
        border-color: var(--bs-primary);
      }

      .mr-option.is-selected {
        border-color: var(--bs-primary);
        box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb), 0.25);
      }

      .mr-option:focus-visible {
        outline: none;
        box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb), 0.25);
      }
      /*Empty Slot (Layout Balance) - Preserves Answer Options Grid symmetry*/
      .mr-option--empty {
        aspect-ratio: 1;
        min-width: 44px;
        min-height: 44px;
        border: 1px dashed var(--bs-border-color);
        border-radius: var(--bs-border-radius);
        background: transparent;
      }

      .mr-illustration-panel {
        background-color: var(--primary-900);
        min-height: 100vh;
      }
      .mr-timer {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--bs-secondary-color);
        min-width: 48px;
        text-align: right;
      }

      .mr-timer.is-warning {
        color: var(--bs-warning);
      }

      .mr-timer.is-danger {
        color: var(--bs-danger);
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
        100% {
          transform: scale(1);
        }
      }

      .mr-timer.pulse {
        animation: pulse 0.8s infinite;
      }
    </style>

    <!--END OF HEAD-->
  </head>

  <body class="bg-light">
    <!-- TOP RIGHT LOGO -->

    <div class="container-fluid">
      <div class="row min-vh-100 align-items-start pt-0 mt-0">
        <!-- LEFT COLUMN — Test Area -->
        <div class="col-12 col-md-5 d-flex flex-column align-items-center">
          <div class="w-100 mr-test-shell">
            <!-- VS Logo & Instruction Title -->
            <div
              class="col-12 d-flex justify-content-center align-items-center gap-2 py-2"
            >
              <a href="../../../index.html" class="d-flex align-items-center">
                <img
                  src="../../../assets/logo/vsLogoWithouText.svg"
                  alt="Vidyaa Saarthi Logo"
                  height="36"
                />
              </a>

              <h6
                class="fw-semibold mb-0"
                style="line-height: 1.2; white-space: nowrap"
              >
                Find the Missing Symbol
              </h6>
            </div>

            <!-- Question Frame -->
            <div class="mb-3">
              <div
                class="mr-frame mr-question-frame"
                aria-label="Question frame"
              >
                <div class="mr-matrix" role="grid" aria-label="3 by 3 matrix">
                  <!-- Question Cell No 1 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 1">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                  <!-- Question Cell No 2 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 2">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                  <!-- Question Cell No 3 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 3">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>

                  <!-- Question Cell No 4 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 4">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                  <!-- Question Cell No 5 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 5">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                  <!-- Question Cell No 6 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 6">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                  <!-- Question Cell No 7 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 7">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                  <!-- Question Cell No 8 -->
                  <div class="mr-cell" role="gridcell" aria-label="Cell 8">
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                  <!-- Question Cell No 9 -->
                  <div
                    class="mr-cell mr-cell--missing"
                    role="gridcell"
                    aria-label="Missing cell"
                  >
                    <img
                      src="../../../assets/graphics/MatrixReasoning/scoredTrialMatrixReasoning/questionMark.svg"
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Answer Frame -->
            <div class="mb-3">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <div class="form-label small mb-0">Answer Option</div>

                <div
                  class="mr-timer"
                  aria-live="polite"
                  aria-label="Time remaining"
                >
                  <span class="mr-timer__value">55</span>s
                </div>
              </div>

              <div class="mr-frame" aria-label="Answer frame">
                <div
                  class="mr-options"
                  role="group"
                  aria-label="Answer options"
                >
                  <!-- Answer Cell No aa -->
                  <button
                    type="button"
                    class="mr-option"
                    data-mr-option="a"
                    aria-pressed="false"
                    aria-label="Answer option a"
                  >
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </button>
                  <!-- Answer Cell No b -->
                  <button
                    type="button"
                    class="mr-option"
                    data-mr-option="b"
                    aria-pressed="false"
                    aria-label="Answer option b"
                  >
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </button>
                  <!-- Answer Cell No c -->
                  <button
                    type="button"
                    class="mr-option"
                    data-mr-option="c"
                    aria-pressed="false"
                    aria-label="Answer option c"
                  >
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </button>
                  <!-- Answer Cell No d -->
                  <button
                    type="button"
                    class="mr-option"
                    data-mr-option="d"
                    aria-pressed="false"
                    aria-label="Answer option d"
                  >
                    <img
                      src=""
                      alt=""
                      class="mr-cell__img"
                      aria-hidden="true"
                    />
                  </button>
                  <div class="mr-option--empty" aria-hidden="true"></div>
                  <div class="mr-option--empty" aria-hidden="true"></div>
                </div>
              </div>
            </div>

            <!-- Confirm Button -->
            <div class="mb-3">
              <button
                type="button"
                class="btn btn-primary w-100"
                data-mr-confirm
                disabled
              >
                Confirm
              </button>
            </div>
          </div>
        </div>

        <!-- RIGHT COLUMN — IMAGE (MD & ABOVE ONLY) -->
        <div
          class="col-md-7 d-none d-md-flex align-items-stretch p-0 mr-illustration-panel"
        >
          <img
            src="../../../assets/illustration/signupAndLogin/signupAndLogin.svg"
            class="img-fluid w-100 h-100 object-fit-cover"
            alt="Matrix reasoning illustration"
          />
        </div>
      </div>
    </div>
    <!-- =====================================================
     STEP 7 — FEEDBACK MODAL (UI ONLY)
===================================================== -->
    <div
      class="modal fade"
      id="mrFeedbackModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title fw-semibold">Vidyaa Saarthi Says</h6>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body small" id="mrFeedbackMessage"></div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              OK
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Java Script CDN-->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
      integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
      crossorigin="anonymous"
    ></script>

    <script>
      (() => {
        const optionButtons = Array.from(
          document.querySelectorAll("[data-mr-option]")
        );
        const confirmButton = document.querySelector("[data-mr-confirm]");

        if (!optionButtons.length) return;

        const setSelected = (selectedButton) => {
          optionButtons.forEach((button) => {
            const isSelected = button === selectedButton;
            button.classList.toggle("is-selected", isSelected);
            button.setAttribute("aria-pressed", isSelected ? "true" : "false");
          });

          if (confirmButton) confirmButton.disabled = false;
        };

        optionButtons.forEach((button) => {
          button.addEventListener("click", () => setSelected(button));
        });

        document.addEventListener("keydown", (event) => {
          if (!/^[1-5]$/.test(event.key)) return;
          const idx = Number(event.key) - 1;
          const target = optionButtons[idx];
          if (!target) return;
          event.preventDefault();
          setSelected(target);
          target.focus();
        });
      })();
    </script>

    <script>
      /* =====================================================
PRACTICE ROUND — STEPS 1–9 (FINAL)
-----------------------------------------------------
 Step 1: Config
 Step 2: Load question images
 Step 3: Countdown timer
 Step 4: Option selection
 Step 5: Confirm → stop timer + lock UI
 Step 6: Evaluate answer
 Step 7: Feedback modal
 Step 8: Auto-next question + reset UI
 Step 9: Practice complete screen
===================================================== */

      (() => {
        /* =====================================================
   STEP 1 — CONFIGURATION
  ===================================================== */

        const PRACTICE_QUESTIONS = [
          {
            id: 1,
            basePath:
              "../../../assets/graphics/MatrixReasoning/practiceTrialMatrixReasoning/question1/",
            correctOption: "d",
            explanation:
              "Each column contains at least two stars. Each row and column contains two circles and one cross. The arrows rotate clockwise.",
          },
          {
            id: 2,
            basePath:
              "../../../assets/graphics/MatrixReasoning/practiceTrialMatrixReasoning/question2/",
            correctOption: "d",
            explanation:
              "Each row and column contain two arrows pointing up and one arrow pointing down. Shading alternates consistently. The star rotates clockwise across rows.",
          },
        ];

        const TIME_LIMIT = 60;
        const WARNING_THRESHOLD = 5;

        let currentQuestionIndex = 0;
        let selectedOption = null;
        let isLocked = false;
        let timeRemaining = TIME_LIMIT;
        let timerInterval = null;

        const optionButtons = Array.from(
          document.querySelectorAll("[data-mr-option]")
        );
        const confirmBtn = document.querySelector("[data-mr-confirm]");
        const timerWrapper = document.querySelector(".mr-timer");
        const timerValueEl = document.querySelector(".mr-timer__value");

        /* =====================================================
   STEP 2 — LOAD QUESTION IMAGES
  ===================================================== */

        function loadPracticeQuestion(index) {
          const q = PRACTICE_QUESTIONS[index];
          if (!q) return;

          // Matrix cells 1–8
          document
            .querySelectorAll(
              ".mr-matrix .mr-cell:not(.mr-cell--missing) .mr-cell__img"
            )
            .forEach((img, i) => {
              img.src = `${q.basePath}${i + 1}.svg`;
            });

          // Options a–d
          const keys = ["a", "b", "c", "d"];
          optionButtons.forEach((btn, i) => {
            const img = btn.querySelector("img");
            if (img) img.src = `${q.basePath}${keys[i]}.svg`;
          });
        }

        /* =====================================================
   STEP 3 — TIMER + GRACE ANIMATION
  ===================================================== */

        function startTimer() {
          stopTimer();
          timeRemaining = TIME_LIMIT;
          updateTimerUI();

          timerInterval = setInterval(() => {
            timeRemaining--;
            updateTimerUI();

            if (timeRemaining <= 0) {
              stopTimer();
              handleTimeout();
            }
          }, 1000);
        }

        function stopTimer() {
          if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
          }
        }

        function updateTimerUI() {
          timerValueEl.textContent = timeRemaining;

          timerWrapper.classList.remove("is-warning", "is-danger", "pulse");

          if (timeRemaining <= WARNING_THRESHOLD && timeRemaining > 0) {
            timerWrapper.classList.add("is-warning", "pulse");
          }

          if (timeRemaining <= 0) {
            timerWrapper.classList.add("is-danger");
          }
        }

        /* =====================================================
   STEP 4 — OPTION SELECTION
  ===================================================== */

        optionButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (isLocked) return;

            optionButtons.forEach((b) => {
              b.classList.remove("is-selected");
              b.setAttribute("aria-pressed", "false");
            });

            btn.classList.add("is-selected");
            btn.setAttribute("aria-pressed", "true");

            selectedOption = btn.dataset.mrOption;
            confirmBtn.disabled = false;
          });
        });

        /* =====================================================
   STEP 5 — CONFIRM
  ===================================================== */

        confirmBtn.addEventListener("click", () => {
          if (isLocked || !selectedOption) return;
          lockUI();

          const q = PRACTICE_QUESTIONS[currentQuestionIndex];
          const isCorrect = selectedOption === q.correctOption;

          showFeedbackModal({
            status: isCorrect ? "correct" : "incorrect",
            correctOption: q.correctOption,
            explanation: q.explanation,
          });
        });

        /* =====================================================
   TIMEOUT HANDLER (UNATTEMPTED)
  ===================================================== */

        function handleTimeout() {
          if (isLocked) return;
          lockUI();

          const q = PRACTICE_QUESTIONS[currentQuestionIndex];

          showFeedbackModal({
            status: "timeout",
            correctOption: q.correctOption,
            explanation: q.explanation,
          });
        }

        function lockUI() {
          isLocked = true;
          stopTimer();
          confirmBtn.disabled = true;

          optionButtons.forEach((btn) => {
            btn.disabled = true;
            btn.style.pointerEvents = "none";
          });
        }

        /* =====================================================
   STEP 7 — FEEDBACK MODAL
  ===================================================== */

        function formatExplanation(text) {
          return String(text || "")
            .split(".")
            .map((s) => s.trim())
            .filter(Boolean)
            .join(".<br>");
        }

        function buildFeedbackHTML({ status, correctOption, explanation }) {
          const config = {
            correct: {
              label: "Correct Answer",
              color: "text-success",
              icon: "✅",
            },
            incorrect: {
              label: "Incorrect Answer",
              color: "text-danger",
              icon: "❌",
            },
            timeout: {
              label: "Time Over",
              color: "text-warning",
              icon: "⏰",
            },
          };

          const c = config[status];

          return `
      <div class="fw-semibold mb-2 ${c.color}">
        ${c.icon} ${c.label}
      </div>

      <div class="mb-2">
        <strong>Correct Answer:</strong> ${correctOption.toUpperCase()}
      </div>

      <div class="mt-2">
        <strong>Explanation</strong>
        <div class="mt-1">${formatExplanation(explanation)}</div>
      </div>
    `;
        }

        function showFeedbackModal(payload) {
          const modalEl = document.getElementById("mrFeedbackModal");
          const modalMsg = document.getElementById("mrFeedbackMessage");

          modalMsg.innerHTML = buildFeedbackHTML(payload);

          const modal = bootstrap.Modal.getOrCreateInstance(modalEl, {
            backdrop: "static",
            keyboard: false,
          });

          modal.show();

          modalEl.addEventListener(
            "hidden.bs.modal",
            () => {
              currentQuestionIndex++;

              if (currentQuestionIndex < PRACTICE_QUESTIONS.length) {
                resetUIForNextQuestion();
                loadPracticeQuestion(currentQuestionIndex);
              } else {
                showPracticeCompletionScreen();
              }
            },
            { once: true }
          );
        }

        /* =====================================================
   STEP 8 — RESET UI
  ===================================================== */

        function resetUIForNextQuestion() {
          isLocked = false;
          selectedOption = null;

          optionButtons.forEach((btn) => {
            btn.classList.remove("is-selected");
            btn.setAttribute("aria-pressed", "false");
            btn.disabled = false;
            btn.style.pointerEvents = "";
          });

          confirmBtn.disabled = true;
          startTimer();
        }

        /* =====================================================
   STEP 9 — PRACTICE COMPLETE
  ===================================================== */

        function showPracticeCompletionScreen() {
          stopTimer();

          const shell = document.querySelector(".mr-test-shell");
          shell.innerHTML = `
      <div class="text-center p-4">
        <h5 class="fw-semibold mb-3">Practice Complete</h5>
        <p class="text-muted small mb-4">
          You’ve completed the practice round.
        </p>
        <div class="d-grid gap-2">
          <button class="btn btn-outline-primary" id="restartPractice">
            Start Practice Again
          </button>
          <button class="btn btn-primary" id="backToInstructions">
            Back to Instructions
          </button>
        </div>
      </div>
    `;

          document
            .getElementById("restartPractice")
            .addEventListener("click", () => location.reload());

          document
            .getElementById("backToInstructions")
            .addEventListener(
              "click",
              () => (window.location.href = "matrixReasoningInstruction.html")
            );
        }

        /* =====================================================
   INIT
  ===================================================== */

        document.addEventListener("DOMContentLoaded", () => {
          loadPracticeQuestion(currentQuestionIndex);
          startTimer();
          confirmBtn.disabled = true;
        });
      })();
    </script>

    <!--  END of Body-->
  </body>
</html>
