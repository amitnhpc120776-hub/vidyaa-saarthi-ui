<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vidyaa Saarthi – Symbol Search (Practice)</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- VIS Design System -->
    <link rel="stylesheet" href="../../../css/VS-Design-System.css" />
    <link rel="stylesheet" href="../../../css/custom-component.css" />

    <style>
      /* ================= SHELL ================= */
      .ss-test-shell {
        max-width: 560px;
        margin-inline: auto;
      }

      .ss-frame {
        background: var(--bs-body-bg);
        border: 1px solid var(--bs-border-color);
        border-radius: var(--bs-border-radius-lg);
        padding: 14px;
        animation: ssFadeIn 160ms ease-out;
      }
      @keyframes ssFadeIn {
        from {
          opacity: 0.75;
        }
        to {
          opacity: 1;
        }
      }

      /* ================= HEADER ================= */
      .ss-header {
        text-align: center;
        padding: 16px 0 8px;
      }

      .ss-header img {
        height: 44px;
        margin-bottom: 6px;
      }

      .ss-title {
        font-weight: 600;
        margin-bottom: 2px;
      }

      .ss-session-timer {
        font-size: 0.85rem;
        color: var(--bs-secondary-color);
      }

      /* ================= LABELS ================= */
      .ss-section-label {
        font-size: 0.8rem;
        color: var(--bs-secondary-color);
        margin-bottom: 6px;
      }

      /* ================= TARGETS ================= */
      .ss-targets-wrapper {
        margin-top: 32px;
      }

      .ss-targets-row {
        display: flex;
        justify-content: center;
        gap: 16px;
      }

      .ss-target {
        width: 56px;
        height: 56px;
        display: grid;
        place-items: center;
        border-radius: var(--bs-border-radius);
        border: 2px solid var(--bs-primary);
        background: var(--primary-50);
        font-size: 1.4rem;
        font-weight: 700;
      }

      /* ================= ANSWERS ================= */
      .ss-answers-wrapper {
        margin-top: 28px;
      }

      .ss-options {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
      }

      .ss-option {
        aspect-ratio: 1;
        min-width: 44px;
        min-height: 44px;
        display: grid;
        place-items: center;
        border-radius: var(--bs-border-radius);
        border: 2px solid var(--bs-border-color);
        background: var(--bs-body-bg);
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        user-select: none;
      }

      .ss-option.is-selected {
        border-color: var(--bs-primary);
        box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb), 0.25);
      }

      .ss-trial-timer {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--bs-secondary-color);
        animation: ssPulse 300ms ease-out;
      }
      @keyframes ssPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
        100% {
          transform: scale(1);
        }
      }
      /* Trial timer warning on timeout */
      .ss-trial-timer.timeout {
        animation: ssTimeoutFlash 400ms ease-out;
      }

      @keyframes ssTimeoutFlash {
        0% {
          color: var(--bs-secondary-color);
        }
        50% {
          color: var(--bs-danger);
        }
        100% {
          color: var(--bs-secondary-color);
        }
      }

      /* ================= FEEDBACK ================= */
      .ss-feedback {
        text-align: center;
        font-size: 0.85rem;
        margin-top: 8px;
        min-height: 18px;
      }

      .ss-feedback.correct {
        color: var(--bs-success);
        animation: ssFinishGlow 400ms ease-out;
      }
      @keyframes ssFinishGlow {
        from {
          opacity: 0.6;
        }
        to {
          opacity: 1;
        }
      }
      .ss-feedback.wrong {
        color: var(--bs-danger);
      }

      /* ================= RIGHT PANEL ================= */
      .ss-illustration-panel {
        background-color: var(--primary-900);
        min-height: 100vh;
      }
      .ss-option.correct {
        border-color: var(--bs-success);
        box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25);
        animation: ssCorrectPop 220ms ease-out;
      }
      @keyframes ssCorrectPop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
        100% {
          transform: scale(1);
        }
      }

      .ss-option.wrong {
        border-color: var(--bs-danger);
        box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
        animation: ssWrongShake 280ms ease-in-out;
      }
      @keyframes ssWrongShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-3px);
        }
        50% {
          transform: translateX(3px);
        }
        75% {
          transform: translateX(-2px);
        }
      }
      /* Subtle highlight on targets when NO is correct */
      .ss-targets-row.no-match {
        animation: ssTargetGlow 300ms ease-out;
      }

      @keyframes ssTargetGlow {
        from {
          box-shadow: 0 0 0 rgba(25, 135, 84, 0.6);
        }
        to {
          box-shadow: 0 0 10px rgba(25, 135, 84, 0.4);
        }
      }
      /* =====================================================
   START OVERLAY
===================================================== */

      /* Optional micro-animation */
      .ss-start-overlay button {
        animation: ssStartPulse 800ms ease-out infinite;
      }

      @keyframes ssStartPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.04);
        }
        100% {
          transform: scale(1);
        }
      }

      /* ================= START CTA ================= */
      .ss-start-cta {
        text-align: center;
        margin-bottom: 8px;
      }

      .ss-start-cta.hidden {
        display: none;
      }
      .ss-task-area.hidden {
        display: none;
      }
      /* ================= PRACTICE COMPLETE ================= */
      .ss-complete-screen {
        margin-top: 64px;
        text-align: left;
        max-width: 420px;
      }
    </style>
  </head>

  <body class="bg-light">
    <div class="container-fluid">
      <div class="row min-vh-100">
        <!-- LEFT -->
        <div class="col-12 col-md-5 d-flex flex-column align-items-center">
          <div class="w-100 ss-test-shell">
            <div class="ss-header">
              <img
                src="../../../assets/logo/vsLogoWithouText.svg"
                alt="Vidyaa Saarthi Logo"
              />
              <div class="ss-title">Search The Symbol</div>
              <div class="ss-start-cta mt-2">
                <button id="startBtn" class="btn btn-primary px-4 py-2">
                  Click to begin
                </button>
              </div>

              <div class="ss-session-timer">
                Time Left: <span id="sessionTimer">2:00</span>
              </div>
            </div>

            <div id="taskArea" class="ss-task-area hidden">
              <!-- TARGETS -->
              <div class="ss-targets-wrapper">
                <div class="ss-section-label text-center">
                  These are the symbols to search for.<br />
                  Any one of them may be present.
                </div>

                <div class="ss-frame">
                  <div class="ss-targets-row">
                    <div class="ss-target"></div>
                    <div class="ss-target"></div>
                  </div>
                </div>
              </div>

              <!-- ANSWERS -->
              <div class="ss-answers-wrapper">
                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <div class="ss-section-label">Symbols you can select</div>
                  <div class="ss-trial-timer">
                    <span id="trialTimer">5</span>s
                  </div>
                </div>

                <div class="ss-frame">
                  <div class="ss-options">
                    <button class="ss-option"></button>
                    <button class="ss-option"></button>
                    <button class="ss-option"></button>
                    <button class="ss-option"></button>
                    <button class="ss-option"></button>
                    <button class="ss-option fw-bold"></button>
                  </div>
                </div>

                <div id="feedback" class="ss-feedback"></div>
              </div>
            </div>
            <!-- PRACTICE COMPLETE SCREEN -->
            <div id="practiceCompleteScreen" class="ss-complete-screen d-none">
              <h5 class="fw-semibold mb-2">Practice Complete</h5>
              <p class="text-muted small mb-4">
                You’ve completed the practice round.
              </p>

              <div class="d-grid gap-2">
                <button id="restartPracticeBtn" class="btn btn-outline-primary">
                  Start Practice Again
                </button>

                <button id="backToInstructionsBtn" class="btn btn-primary">
                  Back to Instructions
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="col-md-7 d-none d-md-flex p-0 ss-illustration-panel">
          <img
            src="../../../assets/illustration/signupAndLogin/signupAndLogin.svg"
            class="img-fluid w-100 h-100 object-fit-cover"
            alt="Illustration"
          />
        </div>
      </div>
    </div>

    <!-- CORE -->
    <script src="symbolSearchCore.js"></script>

    <!-- PRACTICE LOGIC -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        /* =====================================================
       PRACTICE — SYMBOL SEARCH (FRONTEND ONLY)
    ===================================================== */

        /* ---------- SYMBOL POOL ---------- */
        const SYMBOL_POOL = ["○", "△", "□", "⊂", "⊃", "<", ">", "≠", "⊕", "∞"];

        /* ---------- UTILITIES ---------- */
        function shuffle(arr) {
          return arr.sort(() => Math.random() - 0.5);
        }

        function pick(pool, n, exclude = []) {
          return shuffle(pool.filter((s) => !exclude.includes(s))).slice(0, n);
        }

        /* ---------- TRIAL GENERATOR ---------- */
        function generateTrial(id) {
          const targets = pick(SYMBOL_POOL, 2);
          const hasMatch = Math.random() < 0.6;

          let coreOptions, correctAnswer;

          if (hasMatch) {
            const match = targets[Math.floor(Math.random() * 2)];
            const distractors = pick(SYMBOL_POOL, 4, targets);
            coreOptions = shuffle([match, ...distractors]);
            correctAnswer = match;
          } else {
            coreOptions = shuffle(pick(SYMBOL_POOL, 5, targets));
            correctAnswer = "NO";
          }

          return {
            id,
            targets,
            options: [...coreOptions, "NO"], // ✅ NO always 6th
            correctAnswer,
          };
        }

        const PRACTICE_TRIALS = Array.from({ length: 5 }, (_, i) =>
          generateTrial(i + 1)
        );

        /* ---------- DOM REFS ---------- */
        const feedbackEl = document.getElementById("feedback");

        /* ---------- FEEDBACK HANDLER ---------- */
        function showFeedback(trial, selected) {
          const options = document.querySelectorAll(".ss-option");

          options.forEach((btn) => {
            const value = btn.textContent.trim();
            btn.classList.remove("correct", "wrong");

            if (value === trial.correctAnswer) {
              btn.classList.add("correct");
            }

            if (
              selected &&
              value === selected &&
              selected !== trial.correctAnswer
            ) {
              btn.classList.add("wrong");
            }
          });
        }

        /* ---------- RENDER ---------- */
        function renderTrial(trial) {
          document.querySelectorAll(".ss-target").forEach((el, i) => {
            el.textContent = trial.targets[i] || "";
          });

          document.querySelectorAll(".ss-option").forEach((el, i) => {
            el.textContent = trial.options[i] || "";
            el.classList.remove("correct", "wrong", "is-selected");
          });
        }

        /* ---------- CORE INITIALISATION ---------- */
        const core = SymbolSearchCore.create({
          trials: PRACTICE_TRIALS,
          autoAdvance: false, // ✅ PRACTICE CONTROLLED

          onTrialStart({ trial }) {
            renderTrial(trial);
            feedbackEl.textContent = "";
            feedbackEl.className = "ss-feedback";
          },

          onSelect({ trial, selected }) {
            showFeedback(trial, selected);

            feedbackEl.textContent =
              selected === trial.correctAnswer ? "Correct ✔" : "Incorrect ✖";
            feedbackEl.className =
              "ss-feedback " +
              (selected === trial.correctAnswer ? "correct" : "wrong");

            setTimeout(() => {
              core.next();
            }, 800);
          },

          onTimeout({ trial }) {
            showFeedback(trial, null);

            feedbackEl.textContent =
              "Time up ✖ (Correct: " + trial.correctAnswer + ")";
            feedbackEl.className = "ss-feedback wrong";

            setTimeout(() => {
              core.next();
            }, 800);
          },

          onComplete() {
            // Hide task UI
            document.getElementById("taskArea")?.classList.add("d-none");

            // Hide feedback
            feedbackEl.textContent = "";

            // Show completion screen
            document
              .getElementById("practiceCompleteScreen")
              .classList.remove("d-none");
            feedbackEl.className = "ss-feedback correct";
          },
        });

        const startBtn = document.getElementById("startBtn");
        const taskArea = document.getElementById("taskArea");
        const startCTA = document.querySelector(".ss-start-cta");

        startBtn.addEventListener("click", () => {
          startCTA.classList.add("hidden");
          taskArea.classList.remove("hidden");
          core.start();
        });
      });
      /* =====================================================
     PRACTICE COMPLETE BUTTON ACTIONS
  ===================================================== */

      // Restart practice → full reset
      const restartBtn = document.getElementById("restartPracticeBtn");
      if (restartBtn) {
        restartBtn.addEventListener("click", () => {
          window.location.reload();
        });
      }

      // Back to instructions
      const backToInstructionsBtn = document.getElementById(
        "backToInstructionsBtn"
      );
      if (backToInstructionsBtn) {
        backToInstructionsBtn.addEventListener("click", () => {
          window.location.href = "symbolSerachInstruction.html";
        });
      }
    </script>
  </body>
</html>
